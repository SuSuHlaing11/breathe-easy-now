# Fixes_2026-02-14

## Summary of Work
- Wired dashboard uploads to backend health IMHE CSV endpoint.
- Added manual record entry form for IMHE uploads.
- Removed manual ID fields; backend derives IDs by name.
- Centered upload layout on small screens and moved file preview directly under file selector.
- Fixed mobile centering by removing inline margin-left in org dashboard layout.
- Moved file preview inside dashed upload box with a separate remove action below.
- Added multi-file CSV selection with per-file remove and clear-all action.
- Restored session persistence on refresh by hydrating auth state from localStorage.
- Upload History now reads from backend `/uploads` instead of localStorage mock data.
- Manual entry location_name now defaults to org country and is read-only.
- Manual entry uses dropdowns for categorical fields and moves upper/lower into an Advanced toggle.
- Added sanity checks for required fields, numeric values, and year range (1900 to current year + 3).
- Grouped data type + CSV in one block and manual entry in another; moved Add Record button right.
- Inline validation for manual entry; moved Upload File button into CSV block.
- Switched CSV upload to validate/confirm flow with duplicate detection and 50MB limit.
- Duplicate list now paginates (5 per page) with a dupe-detail endpoint.
- Dupes pagination now keeps the previous list visible while loading to avoid UI flicker.
- Confirm now ignores race-condition dupes; multi-file confirm no longer clears all files; token expiry is shown.
- Added CSV preview dialog (first 5 lines) before validation.
- Made CSV preview boxes horizontally scrollable with hidden scrollbars.
- Validation results now display in the same modal after preview confirmation.
- Analysis year slider now uses backend min/max years and shows a limited-data warning.
- Upload History now supports viewing Mongo records with pagination, and editing records via dropdowns.
- Sorted age dropdown in upload manual entry using the same ordering as Analysis.
- Hardcoded manual uploads to `All Population` (population_group_id=1) and removed the field from the UI.
- Enforced CSV-only uploads with 25MB size limit in UI.
- Added API helpers for IMHE CSV and manual record upload.
- Added IMHE percentiles API and wired map color scaling to use global P1-P99 range.
- Applied log scaling to map color normalization for better spread.
- Added gamma adjustment to further separate high-end values.
- Mixed P1 min with observed max to keep large outliers visible.
- Percentile scale now uses fixed 2020-2023 P1 + max window for stable colors across sparse years.
- Capped map scale max at 200,000 to match expected upper bound.
- Slider now uses Radix defaults; comparison year is added/removed via buttons.
- Comparison maps now load per-year data instead of reusing the same dataset.
- Comparison maps now clear and remount per-year data on year change for correctness.
- Reverted analysis heatmap back to the line/composed chart view.

## Checkpoints Status
- Frontend tests: **NOT RUN**
- Manual smoke: **PENDING**

## Files Updated
- `src/pages/dashboard/UploadData.tsx`
- `src/lib/API.ts`
- `src/components/DataVisualization.tsx`
- `src/components/LeafletMap.tsx`
